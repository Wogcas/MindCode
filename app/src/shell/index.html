<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCode - Plataforma de Aprendizaje</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../../assets/styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#64A85F', 50: '#E8F5E6', 100: '#D1EBC9', 200: '#A3D894', 300: '#8BCE7F', 400: '#73C169', 500: '#64A85F', 600: '#508A4C', 700: '#3C6739', 800: '#284426', 900: '#142213' },
                    },
                    fontFamily: { Colmeak: ['Colmeak', 'sans-serif'], sans: ['Quicksand', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
</head>

<body id="app-root" class="font-sans bg-gray-50">
    
    <app-header></app-header>

    <main id="vista" class="pt-6 min-h-screen"></main>

    <script type="module" src="../componentes/header.js"></script>
    <script type="module" src="../componentes/Pagina404.js"></script>
    
    <script type="module" src="../dashboard/dashboardAlumno.js"></script>
    <script type="module" src="../dashboard/DashboardMaestro.js"></script>
    
    <script type="module" src="../mis-cursos/MisCursosMaestro.js"></script>
    <script type="module" src="../mis-cursos/MisCursosAlumno.js"></script>
    
    <script type="module" src="../perfil/editarPerfil.js"></script>
    <script type="module" src="../unirse-cursos/unirseACurso.js"></script>

    <script type="module" src="../ver-curso/VisorLeccion.js"></script>
    <script type="module" src="../utils/router.js"></script>


    <script type="module">
        // Este script solo corre una vez al cargar la página
        
        const usuario = JSON.parse(localStorage.getItem("usuario") || 'null');
        const mainContent = document.getElementById('vista');
        
        // A. Protección: Si no hay usuario, mandar al login
        if (!usuario && !window.location.href.includes('login')) {
             window.location.href = "../login/index.html";
        }

        // B. Sistema de vistas con ?vista=
        function render() {
            const params = new URLSearchParams(window.location.search);
            const vista = params.get("vista");
            
            // Si hay parámetro vista, usarlo
            if (vista) {
                console.log("Cargando vista:", vista);
                mainContent.innerHTML = '';
                
                switch (vista) {
                    case "dashboardMaestro":
                        mainContent.innerHTML = "<dashboard-maestro></dashboard-maestro>";
                        break;
                    
                    case "dashboardAlumno":
                        mainContent.innerHTML = "<dashboard-alumno></dashboard-alumno>";
                        break;
                    
                    case "cursosMaestro":
                        mainContent.innerHTML = "<mis-cursos-maestro></mis-cursos-maestro>";
                        break;
                    
                    case "cursosAlumno":
                        mainContent.innerHTML = "<mis-cursos-alumno></mis-cursos-alumno>";
                        break;
                    
                    case "perfil":
                        mainContent.innerHTML = "<editar-perfil></editar-perfil>";
                        break;
                    
                    case "unirseACurso":
                        const cursoId = params.get("id");
                        mainContent.innerHTML = `<unirse-a-curso cursoId="${cursoId || ''}"></unirse-a-curso>`;
                        break;
                    
                    default:
                        // Vista no reconocida, ir al dashboard según tipo
                        const dashboardVista = usuario.tipo === "Maestro" ? "dashboardMaestro" : "dashboardAlumno";
                        window.location.href = `?vista=${dashboardVista}`;
                }
                return;
            }
            
            // C. Si no hay parámetro vista, verificar hash routing para compatibilidad
            if (window.location.hash && window.location.hash !== '#/') {
                // Dejar que el router de hash maneje esto
                return;
            }
            
            // D. Si no hay ni vista ni hash, ir al dashboard por defecto
            const dashboardVista = usuario.tipo === "Maestro" ? "dashboardMaestro" : "dashboardAlumno";
            window.location.href = `?vista=${dashboardVista}`;
        }
        
        // Detectar cambios en navegación
        window.addEventListener('popstate', render);
        
        // Carga inicial
        render();
    </script>

</body>
</html>